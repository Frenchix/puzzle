import{u as q,a as O,r as n,b as J,o as R,c as U,d as a,e as o,f as d,t as C,g as s,h as x,_ as H,i as p,w as K,F as k,j as Q,n as W,k as X,l as Y}from"./index-9f9f1bdc.js";const Z={key:0,class:"text-center text-lg text-[#007bff]"},ee={key:1,class:"text-center text-lg text-red-500"},te={class:"w-full flex flex-col-reverse lg:flex-row"},se={key:0,class:"w-2/12 py-2 max-w-[200px] m-auto lg:m-0"},ae={key:1,class:"game-container w-10/12 min-w-[900px] m-auto"},oe={class:"w-full flex justify-around"},ne={class:"timer"},le=["src"],re=["src"],ue={class:"puzzle-area"},ie={class:"puzzle-pieces"},ce=["onMousedown"],de={key:1,class:"completion-animation"},me={__name:"GameInterface",setup(M){const I=q(),{stopTimer:$,initTimer:P}=I,{formatTime:D}=X(),E=O(),f=n(!1),r=n(null),m=n(null),v=n(!0),g=n(!1),z=n(""),w=n(null),h=n(.3),{pieces:_,gameTime:F,showCompletionAnimation:N,startDrag:S,onDrag:j,endDrag:L}=J(r,m),V=t=>({left:t.x+"px",top:t.y+"px",width:t.width+"px",height:t.height+"px",backgroundImage:`url(${t.fileName})`,backgroundSize:"cover",position:"absolute"});function A(t,u,l=3){return new Promise((i,y)=>{const e=new Image;let c=0;const T=()=>{e.onload=()=>{u.key=Date.now()+Math.random(),i(e)},e.onerror=()=>{c<l?(c++,console.log(`Tentative de rechargement de l'image : ${t}, essai n° ${c}`),setTimeout(T,1e3)):(g.value=!0,z.value="Erreur lors du chargement des pièces.",y(new Error(`Échec du chargement de l'image après ${l} tentatives : ${t}`)))},e.src=t};T()})}async function B(){location.reload()}function G(){f.value=!0}function b(){f.value=!1}return R(()=>{$(),fetch("https://puzzle-01s0.onrender.com/api/deleteFiles",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(_.value)})}),U(async()=>{try{P(),r.value=parseInt(E.query.imageId,10),m.value=parseInt(E.query.pieces,10);const u=await(await fetch(`https://puzzle-01s0.onrender.com/api/getImage/${r.value}`)).json();w.value=u.src;const i=await(await fetch(`https://puzzle-01s0.onrender.com/api/getPieces?id=${r.value}&nbPieces=${m.value}`,{mode:"cors"})).json(),y=i.map(e=>A(e.fileName,e));await Promise.all(y),document.addEventListener("mousemove",j),document.addEventListener("mouseup",L),_.value=i,_.value.forEach(e=>{e.key=Date.now()+Math.random(),e.width=e.width*h.value,e.height=e.height*h.value,e.attachmentPoints.forEach(c=>{c.x*=h.value,c.y*=h.value})}),v.value=!1}catch(t){g.value=!0,z.value="Erreur lors du chargement des pièces.",v.value=!1,console.error("Erreur lors du chargement des données du puzzle:",t)}}),(t,u)=>(a(),o(k,null,[v.value?(a(),o("div",Z,"Chargement...")):d("",!0),g.value?(a(),o("div",ee,C(z.value),1)):d("",!0),s("div",te,[r.value&&m.value?(a(),o("div",se,[x(H,{id:r.value,pieces:m.value},null,8,["id","pieces"])])):d("",!0),!v.value&&!g.value?(a(),o("div",ae,[s("div",oe,[s("button",{class:"button h-fit",onClick:B},"Recommencer"),s("div",ne,"Temps écoulé: "+C(p(D)(p(F))),1),s("div",{class:"puzzle-preview",onClick:G},[s("img",{src:w.value,alt:"Aperçu du puzzle"},null,8,le)])]),f.value?(a(),o("div",{key:0,class:"image-modal",onClick:b},[s("div",{class:"image-modal-content",onClick:u[0]||(u[0]=K(()=>{},["stop"]))},[s("img",{src:w.value,alt:"Agrandissement du puzzle"},null,8,re),s("button",{class:"button close-modal",onClick:b},"Fermer")])])):d("",!0),s("div",ue,[s("div",ie,[(a(!0),o(k,null,Q(p(_),l=>(a(),o("div",{key:l.key,class:"puzzle-piece",style:W(V(l)),onMousedown:i=>p(S)(i,l)},null,44,ce))),128))])]),p(N)?(a(),o("div",de," Félicitations ! Puzzle terminé ! ")):d("",!0)])):d("",!0)])],64))}},ve={__name:"GameView",setup(M){return(I,$)=>(a(),o(k,null,[s("header",null,[x(Y)]),x(me)],64))}};export{ve as default};
