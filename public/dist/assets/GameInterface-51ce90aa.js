import{J as U,r as l,K as q,L as Q,o as W,H as r,a as s,c as o,e as i,t as g,d as X,M as Y,b as n,p as c,j as Z,F as P,B as ee,N as te,O as ae}from"./index-a4eef16f.js";const se={key:0,class:"text-center text-lg text-[#007bff]"},oe={key:1,class:"text-center text-lg text-red-500"},ne={key:2,class:"w-full flex flex-col-reverse lg:flex-row"},le={key:0,class:"w-2/12 py-2 max-w-[200px] m-auto lg:m-0"},ie={class:"game-container flex-auto min-w-[900px] m-auto"},ue={class:"w-full flex justify-around"},re={key:0},ce={key:1},de={class:"timer"},me=["src"],ve=["src"],ge={class:"puzzle-area"},he={class:"puzzle-pieces"},ze=["onMousedown"],fe={key:1,class:"countdown"},pe={key:2,class:"completion-animation"},ye={__name:"GameInterface",props:["puzzleImage","puzzleData","nbPieces","imageId","duel","roomId","isAdmin"],emits:["changePuzzle"],setup(y,{emit:C}){const e=y,D=C,E=U(),{stopTimer:k,initTimer:T,startTimer:F}=E,{formatTime:M}=te(),h=l(!1),d=l(!0),z=l(!1),w=l(""),f=l(!1),p=l(5),x=l(!1),_=l(!1);let I=l("Félicitation, puzzle terminé !!");const m=l(.3),{pieces:v,gameTime:S,showCompletionAnimation:A,startDrag:L,onDrag:N,endDrag:B,loadImage:j,triggerCompletionAnimation:$}=q(e.imageId,e.nbPieces,e.duel,e.roomId),O=a=>({left:a.x+"px",top:a.y+"px",width:a.width+"px",height:a.height+"px",backgroundImage:`url(${a.fileName})`,backgroundSize:"cover",position:"absolute"});function V(){x.value=!0,r.readyToPlay(e.roomId)}function G(){r.changePuzzle(e.roomId)}async function J(){location.reload()}function R(){h.value=!0}function b(){h.value=!1}function H(a,t){_.value&&L(a,t)}return Q(()=>{k()}),W(async()=>{try{T();const a=e.puzzleData.map(t=>j(t.fileName,t));await Promise.all(a),document.addEventListener("mousemove",N),document.addEventListener("mouseup",B),v.value=e.puzzleData,v.value.forEach(t=>{t.key=Date.now()+Math.random(),t.width=t.width*m.value,t.height=t.height*m.value,t.attachmentPoints.forEach(u=>{u.x*=m.value,u.y*=m.value})}),e.duel==="non"?(fetch("https://puzzle.osc-fr1.scalingo.io/api/deleteFiles",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(v.value)}),_.value=!0):r.onStartCountdown(()=>{f.value=!0;const t=setInterval(()=>{p.value--,p.value===0&&(clearInterval(t),f.value=!1,_.value=!0,F())},1e3)}),d.value=!1}catch(a){z.value=!0,w.value="Erreur lors du chargement des pièces.",d.value=!1,console.error("Erreur lors du chargement des données du puzzle:",a)}r.onPuzzleFinished(a=>{I.value=`Le joueur ${a} vient de finir le puzzle, Bravo!`,k(),$()}),r.onchangePuzzle(()=>{D("changePuzzle")})}),(a,t)=>(s(),o(P,null,[d.value?(s(),o("div",se,"Chargement...")):i("",!0),z.value?(s(),o("div",oe,g(w.value),1)):i("",!0),!d.value&&!z.value?(s(),o("div",ne,[e.imageId&&e.nbPieces&&y.duel==="non"?(s(),o("div",le,[X(Y,{id:e.imageId,pieces:e.nbPieces},null,8,["id","pieces"])])):i("",!0),n("div",ie,[n("div",ue,[e.duel==="oui"?(s(),o("div",re,[!x.value&&!e.isAdmin?(s(),o("button",{key:0,class:"button h-fit",onClick:V},"Prêt")):i("",!0),e.isAdmin?(s(),o("button",{key:1,class:"button h-fit",onClick:G},"Changer de puzzle")):i("",!0)])):(s(),o("div",ce,[n("button",{class:"button h-fit",onClick:J},"Recommencer")])),n("div",de,"Temps écoulé: "+g(c(M)(c(S))),1),n("div",{class:"puzzle-preview",onClick:R},[n("img",{src:e.puzzleImage,alt:"Aperçu du puzzle"},null,8,me)])]),h.value?(s(),o("div",{key:0,class:"image-modal",onClick:b},[n("div",{class:"image-modal-content",onClick:t[0]||(t[0]=Z(()=>{},["stop"]))},[n("img",{src:e.puzzleImage,alt:"Agrandissement du puzzle"},null,8,ve),n("button",{class:"button close-modal",onClick:b},"Fermer")])])):i("",!0),n("div",ge,[n("div",he,[(s(!0),o(P,null,ee(c(v),u=>(s(),o("div",{key:u.key,class:"puzzle-piece",style:ae(O(u)),onMousedown:K=>H(K,u)},null,44,ze))),128))])]),f.value?(s(),o("div",fe,g(p.value),1)):i("",!0),c(A)?(s(),o("div",pe,g(c(I)),1)):i("",!0)])])):i("",!0)],64))}};export{ye as _};
