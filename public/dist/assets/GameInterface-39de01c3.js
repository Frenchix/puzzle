import{J as H,r as l,K,L as U,o as q,H as c,a as s,c as o,e as i,t as h,d as Q,M as W,b as n,p as u,j as X,F as b,B as Y,N as Z,O as ee}from"./index-16b34eb6.js";const te={key:0,class:"text-center text-lg text-[#007bff]"},se={key:1,class:"text-center text-lg text-red-500"},oe={key:2,class:"w-full flex flex-col-reverse lg:flex-row"},ae={key:0,class:"w-2/12 py-2 max-w-[200px] m-auto lg:m-0"},ne={class:"game-container flex-auto min-w-[900px] m-auto"},le={class:"w-full flex justify-around"},ie={key:0},re={key:1},ue={class:"timer"},ce=["src"],de=["src"],me={class:"puzzle-area"},ve={class:"puzzle-pieces"},he=["onMousedown"],ze={key:1,class:"countdown"},ge={key:2,class:"completion-animation"},fe={__name:"GameInterface",props:["puzzleImage","puzzleData","nbPieces","imageId","duel","roomId","isAdmin"],emits:["changePuzzle"],setup(_,{emit:P}){const e=_,C=P,E=H(),{stopTimer:y,initTimer:T,startTimer:D}=E,{formatTime:F}=Z(),z=l(!1),d=l(!0),g=l(!1),k=l(""),p=l(!1),f=l(5),w=l(!1);let x=l("Félicitation, puzzle terminé !!");const m=l(.3),{pieces:v,gameTime:M,showCompletionAnimation:S,startDrag:A,onDrag:L,endDrag:N,loadImage:B,triggerCompletionAnimation:j}=K(e.imageId,e.nbPieces,e.duel,e.roomId),$=a=>({left:a.x+"px",top:a.y+"px",width:a.width+"px",height:a.height+"px",backgroundImage:`url(${a.fileName})`,backgroundSize:"cover",position:"absolute"});function O(){w.value=!0,c.readyToPlay(e.roomId)}function V(){c.changePuzzle(e.roomId)}async function G(){location.reload()}function J(){z.value=!0}function I(){z.value=!1}return U(()=>{y()}),q(async()=>{try{T();const a=e.puzzleData.map(t=>B(t.fileName,t));await Promise.all(a),document.addEventListener("mousemove",L),document.addEventListener("mouseup",N),v.value=e.puzzleData,v.value.forEach(t=>{t.key=Date.now()+Math.random(),t.width=t.width*m.value,t.height=t.height*m.value,t.attachmentPoints.forEach(r=>{r.x*=m.value,r.y*=m.value})}),e.duel==="non"?fetch("https://puzzle-01s0.onrender.com/api/deleteFiles",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(v.value)}):c.onStartCountdown(()=>{p.value=!0;const t=setInterval(()=>{f.value--,f.value===0&&(clearInterval(t),p.value=!1,D())},1e3)}),d.value=!1}catch(a){g.value=!0,k.value="Erreur lors du chargement des pièces.",d.value=!1,console.error("Erreur lors du chargement des données du puzzle:",a)}c.onPuzzleFinished(a=>{x.value=`Le joueur ${a} vient de finir le puzzle, Bravo!`,y(),j()}),c.onchangePuzzle(()=>{C("changePuzzle")})}),(a,t)=>(s(),o(b,null,[d.value?(s(),o("div",te,"Chargement...")):i("",!0),g.value?(s(),o("div",se,h(k.value),1)):i("",!0),!d.value&&!g.value?(s(),o("div",oe,[e.imageId&&e.nbPieces&&_.duel==="non"?(s(),o("div",ae,[Q(W,{id:e.imageId,pieces:e.nbPieces},null,8,["id","pieces"])])):i("",!0),n("div",ne,[n("div",le,[e.duel==="oui"?(s(),o("div",ie,[!w.value&&!e.isAdmin?(s(),o("button",{key:0,class:"button h-fit",onClick:O},"Prêt")):i("",!0),e.isAdmin?(s(),o("button",{key:1,class:"button h-fit",onClick:V},"Changer de puzzle")):i("",!0)])):(s(),o("div",re,[n("button",{class:"button h-fit",onClick:G},"Recommencer")])),n("div",ue,"Temps écoulé: "+h(u(F)(u(M))),1),n("div",{class:"puzzle-preview",onClick:J},[n("img",{src:e.puzzleImage,alt:"Aperçu du puzzle"},null,8,ce)])]),z.value?(s(),o("div",{key:0,class:"image-modal",onClick:I},[n("div",{class:"image-modal-content",onClick:t[0]||(t[0]=X(()=>{},["stop"]))},[n("img",{src:e.puzzleImage,alt:"Agrandissement du puzzle"},null,8,de),n("button",{class:"button close-modal",onClick:I},"Fermer")])])):i("",!0),n("div",me,[n("div",ve,[(s(!0),o(b,null,Y(u(v),r=>(s(),o("div",{key:r.key,class:"puzzle-piece",style:ee($(r)),onMousedown:R=>u(A)(R,r)},null,44,he))),128))])]),p.value?(s(),o("div",ze,h(f.value),1)):i("",!0),u(S)?(s(),o("div",ge,h(u(x)),1)):i("",!0)])])):i("",!0)],64))}};export{fe as _};
